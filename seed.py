from app import create_app, db
from app.models import Space, Booking

# (카테고리: 서브카테고리)
CATEGORY_MAP = {
    '인문 스터디룸': '스터디룸',
    '해동 스터디룸': '스터디룸',
    '학생라운지 스터디룸': '스터디룸',
    '가무연습실': '가무연습실',
    '운동장': '운동장',
    '테니스 코드': '테니스 코드',
    '농구장': '농구장',
    '풋살파크': '풋살파크',
    '피클볼 코트': '피클볼 코트', #오타 수정
}

#서브카테고리별 좌표(위도, 경도) 매핑
COORDINATE_MAP = {
    '인문 스터디룸': (37.45078334666676, 126.653069856456),
    '해동 스터디룸': (37.450674645592095, 126.65711628773977),
    '학생라운지 스터디룸': (37.450493373251106, 126.6575239674216),
    '가무연습실': (37.44945931699783, 126.65669662369501),
    '운동장': (37.449810475130896, 126.65123081715912),
    '테니스 코드': (37.44866610870164, 126.6512022264584),
    '농구장': (37.45055049260407, 126.65163423390864),
    '풋살파크': (37.44960675647723, 126.65165838766397),
    '피클볼 코트': (37.450532528389985, 126.65088983381678)
}

# (이름, 서브카테고리, 위치, 기본 수용인원)
spaces_data = [
    # 인문 스터디룸 (5개)
    ('인문 스터디룸 B', '인문 스터디룸', '5남-032B', 4),
    ('인문 스터디룸 C', '인문 스터디룸', '5남-032C', 4),
    ('인문 스터디룸 D', '인문 스터디룸', '5남-032D', 6),
    ('인문 스터디룸 E', '인문 스터디룸', '5남-032E', 6),
    ('인문 스터디룸 F', '인문 스터디룸', '5남-032F', 6),
    # 해동 스터디룸 (7개)
    ('해동 스터디룸 A', '해동 스터디룸', '하-132A', 4),
    ('해동 스터디룸 B', '해동 스터디룸', '하-132B', 4),
    ('해동 스터디룸 C', '해동 스터디룸', '하-132C', 4),
    ('해동 스터디룸 D', '해동 스터디룸', '하-132D', 4),
    ('해동 스터디룸 E', '해동 스터디룸', '하-132E', 6),
    ('해동 스터디룸 F', '해동 스터디룸', '하-132F', 6),
    ('해동 스터디룸 G', '해동 스터디룸', '하-132G', 6),
    # 학생라운지 스터디룸 (1개)
    ('학생라운지 스터디룸', '학생라운지 스터디룸', '하-021', 8),
    # 가무연습실 (3개)
    ('가무연습실 403호', '가무연습실', '학생회관 403호', 10),
    ('가무연습실 404호', '가무연습실', '학생회관 404호', 10),
    ('가무연습실 406호', '가무연습실', '학생회관 406호', 10),
    # 운동장 (3개)
    ('축구장', '운동장', '운동장 (본관 앞)', 50),
    ('다목적구장 1', '운동장', '학군단 쪽', 30),
    ('다목적구장 2', '운동장', '5남 쪽', 30),
    # 테니스 코드 (6개) - (프론트 기준 '테니스 코드'로 통일)
    ('제1테니스장 3번', '테니스 코드', '제1테니스장', 4),
    ('제1테니스장 4번', '테니스 코드', '제1테니스장', 4),
    ('제1테니스장 5번', '테니스 코드', '제1테니스장', 4),
    ('제2테니스장 6번', '테니스 코드', '제2테니스장', 4),
    ('제2테니스장 7번', '테니스 코드', '제2테니스장', 4),
    ('제2테니스장 8번', '테니스 코드', '제2테니스장', 4),
    # 농구장 (4개)
    ('농구장 1면', '농구장', '야구장 쪽 첫번째', 10),
    ('농구장 2면', '농구장', '야구장 쪽 두번째', 10),
    ('농구장 3면', '농구장', '야구장 쪽 세번째', 10),
    ('농구장 4면', '농구장', '야구장 쪽 네번째', 10),
    # 인하풋살파크 (2개) - (프론트 기준 '풋살파크'로 통일)
    ('인하풋살파크 A', '풋살파크', '풋살파크', 12),
    ('인하풋살파크 D', '풋살파크', '풋살파크', 12),
    # 피클볼 (5개) - (프론트 기준 '피클볼 코드'로 통일)
    ('피클볼 1코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 2코트 (우레탄)', '피클볼 코드', '피클볼장', 4),
    ('피클볼 3코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 4코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 5코트', '피클볼 코드', '피클볼장', 4),
]

def initialize_spaces():
    app = create_app()
    with app.app_context():
        try:
            
            print("INFO: 기존 예약(Booking) 데이터를 모두 삭제합니다...")
            db.session.query(Booking).delete()

            
            print("INFO: 기존 장소(Space) 데이터를 모두 삭제합니다...")
            db.session.query(Space).delete()
            
            
            spaces_to_add = []
            for name, sub_cat, loc, cap in spaces_data:
                category = CATEGORY_MAP.get(sub_cat, '기타')
                
          
                coords = COORDINATE_MAP.get(sub_cat)
                lat, lng = (None, None)
                if coords:
                    lat, lng = coords

                new_space = Space(
                    name=name,
                    category=category,
                    subCategory=sub_cat,
                    location=loc,
                    capacity=cap,
                    latitude=lat,    
                    longitude=lng
                )
                spaces_to_add.append(new_space)
            
           
            print(f"INFO: 총 {len(spaces_to_add)}개의 새 장소 데이터를 추가합니다...")
            db.session.add_all(spaces_to_add)
            
            
            db.session.commit()
            print("SUCCESS: 장소 데이터베이스가 성공적으로 초기화되었습니다.")

        except Exception as e:
            db.session.rollback()
            print(f"ERROR: 데이터 초기화 중 오류 발생 - {e}")


if __name__ == '__main__':
    initialize_spaces()