from app import create_app, db
from app.models import Space

# 프론트엔드 코드(TimeFocusSelectPage.jsx)의 카테고리 분류를 따릅니다.
# (카테고리: 서브카테고리)
CATEGORY_MAP = {
    '인문 스터디룸': '스터디룸',
    '해동 스터디룸': '스터디룸',
    '학생라운지 스터디룸': '스터디룸',
    '가무연습실': '가무연습실',
    '운동장': '운동장',
    '테니스 코드': '테니스 코드',
    '농구장': '농구장',
    '풋살파크': '풋살파크',
    '피클볼 코드': '피클볼 코드',
}

# (이름, 서브카테고리, 위치, 기본 수용인원)
spaces_data = [
    # 인문 스터디룸 (5개)
    ('인문 스터디룸 B', '인문 스터디룸', '5남-032B', 4),
    ('인문 스터디룸 C', '인문 스터디룸', '5남-032C', 4),
    ('인문 스터디룸 D', '인문 스터디룸', '5남-032D', 6),
    ('인문 스터디룸 E', '인문 스터디룸', '5남-032E', 6),
    ('인문 스터디룸 F', '인문 스터디룸', '5남-032F', 6),
    # 해동 스터디룸 (7개)
    ('해동 스터디룸 A', '해동 스터디룸', '하-132A', 4),
    ('해동 스터디룸 B', '해동 스터디룸', '하-132B', 4),
    ('해동 스터디룸 C', '해동 스터디룸', '하-132C', 4),
    ('해동 스터디룸 D', '해동 스터디룸', '하-132D', 4),
    ('해동 스터디룸 E', '해동 스터디룸', '하-132E', 6),
    ('해동 스터디룸 F', '해동 스터디룸', '하-132F', 6),
    ('해동 스터디룸 G', '해동 스터디룸', '하-132G', 6),
    # 학생라운지 스터디룸 (1개)
    ('학생라운지 스터디룸', '학생라운지 스터디룸', '하-021', 8),
    # 가무연습실 (3개)
    ('가무연습실 403호', '가무연습실', '학생회관 403호', 10),
    ('가무연습실 404호', '가무연습실', '학생회관 404호', 10),
    ('가무연습실 406호', '가무연습실', '학생회관 406호', 10),
    # 운동장 (3개)
    ('축구장', '운동장', '운동장 (본관 앞)', 50),
    ('다목적구장 1', '운동장', '학군단 쪽', 30),
    ('다목적구장 2', '운동장', '5남 쪽', 30),
    # 테니스 코드 (6개) - (프론트 기준 '테니스 코드'로 통일)
    ('제1테니스장 3번', '테니스 코드', '제1테니스장', 4),
    ('제1테니스장 4번', '테니스 코드', '제1테니스장', 4),
    ('제1테니스장 5번', '테니스 코드', '제1테니스장', 4),
    ('제2테니스장 6번', '테니스 코드', '제2테니스장', 4),
    ('제2테니스장 7번', '테니스 코드', '제2테니스장', 4),
    ('제2테니스장 8번', '테니스 코드', '제2테니스장', 4),
    # 농구장 (4개)
    ('농구장 1면', '농구장', '야구장 쪽 첫번째', 10),
    ('농구장 2면', '농구장', '야구장 쪽 두번째', 10),
    ('농구장 3면', '농구장', '야구장 쪽 세번째', 10),
    ('농구장 4면', '농구장', '야구장 쪽 네번째', 10),
    # 인하풋살파크 (2개) - (프론트 기준 '풋살파크'로 통일)
    ('인하풋살파크 A', '풋살파크', '풋살파크', 12),
    ('인하풋살파크 D', '풋살파크', '풋살파크', 12),
    # 피클볼 (5개) - (프론트 기준 '피클볼 코드'로 통일)
    ('피클볼 1코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 2코트 (우레탄)', '피클볼 코드', '피클볼장', 4),
    ('피클볼 3코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 4코트', '피클볼 코드', '피클볼장', 4),
    ('피클볼 5코트', '피클볼 코드', '피클볼장', 4),
]

def initialize_spaces():
    app = create_app()
    with app.app_context():
        try:
            # 1. 기존의 모든 Space 데이터를 삭제 (초기화)
            print("INFO: 기존 장소(Space) 데이터를 모두 삭제합니다...")
            db.session.query(Space).delete()
            
            # 2. 새 데이터 리스트 생성
            spaces_to_add = []
            for name, sub_cat, loc, cap in spaces_data:
                category = CATEGORY_MAP.get(sub_cat, '기타') # 맵에서 메인 카테고리 찾기
                
                new_space = Space(
                    name=name,
                    category=category,
                    subCategory=sub_cat,
                    location=loc,
                    capacity=cap
                )
                spaces_to_add.append(new_space)
            
            # 3. DB에 일괄 추가
            print(f"INFO: 총 {len(spaces_to_add)}개의 새 장소 데이터를 추가합니다...")
            db.session.add_all(spaces_to_add)
            
            # 4. 커밋 (최종 저장)
            db.session.commit()
            print("SUCCESS: 장소 데이터베이스가 성공적으로 초기화되었습니다.")

        except Exception as e:
            db.session.rollback()
            print(f"ERROR: 데이터 초기화 중 오류 발생 - {e}")

# 이 스크립트를 직접 실행할 때만 함수가 호출되도록
if __name__ == '__main__':
    initialize_spaces()